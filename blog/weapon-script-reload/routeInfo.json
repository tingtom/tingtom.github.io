{"template":"../src/containers/Post","sharedHashesByProp":{},"data":{"title":"Weapon script reloading in Source SDK","slug":"weapon-script-reload","date":"2019-12-13T00:00:00.000Z","mins":5,"summary":"In Source SDK you have to restart after editing a weapon script, this code will let you use a console command to reload the script of the current weapon after editing it","contents":"<p>In Source SDK you have to restart after editing a weapon script, this can be a pain when messing around with ammo or custom features you&#39;ve added. I&#39;m not 100% sure if everything works after reloading the script but it sure helps.</p>\n<p>First of all we&#39;re going to add a function called ReloadScheme to the basecombatweapon class so in basecombatweapon_shared.h add this in the public section:</p>\n<pre><code class=\"language-cpp\">virtual void ReloadScheme()\n{\n    ReadWeaponDataFromFileForSlot(filesystem, GetClassname(), &amp;m_hWeaponFileInfo, GetEncryptionKey(), true);\n}</code></pre>\n<p>also make sure this is at the top:</p>\n<pre><code class=\"language-cpp\">#include &quot;weapon_parse.h&quot;</code></pre>\n<p>in weapon_parse.h add a reset boolean to ReadWeaponDataFromFileForSlot like so:</p>\n<pre><code class=\"language-cpp\">// The weapon parse function\nbool ReadWeaponDataFromFileForSlot( IFileSystem* filesystem, const char *szWeaponName, \n    WEAPON_FILE_INFO_HANDLE *phandle, const unsigned char *pICEKey = NULL, bool reset = false );</code></pre>\n<p>then in the code for the function in weapon_parse.cpp add a check for the reset boolean:</p>\n<pre><code class=\"language-cpp\">if (reset)\n{\n    unsigned short lookup = m_WeaponInfoDatabase.Find(szWeaponName);\n    if (lookup != m_WeaponInfoDatabase.InvalidIndex())\n    {\n        delete m_WeaponInfoDatabase[lookup];\n        m_WeaponInfoDatabase.RemoveAt(lookup);\n    }\n}</code></pre>\n<p>under the return false at the top of the function. Then to wrap it all together add the console command to the top of the basecombatweapon_shared.cpp file within <code>#if !defined( CLIENT_DLL )</code></p>\n<pre><code class=\"language-cpp\">void CC_ReloadScript(void)\n{\n    CBasePlayer* pPlayer = UTIL_GetCommandClient();\n    if (pPlayer == NULL)\n        return;\n\n    CBaseCombatWeapon *pWeapon = pPlayer-&gt;GetActiveWeapon();\n    if (pWeapon == NULL)\n        return;\n\n    pWeapon-&gt;ReloadScheme();\n}\n\nstatic ConCommand weapon_reloadscript(&quot;weapon_reloadscript&quot;, CC_ReloadScript);</code></pre>\n"},"path":"blog/weapon-script-reload"}
